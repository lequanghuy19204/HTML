<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" />
    <title>GIỎ HÀNG</title>
</head>

<body>
    <div class="app">
        <!-- navBar -->
        <nav id="navbar" class="nav">
            <i onclick="handleDarkMode()" id="toggleMobile" class="fas fa-moon fa-moon_mobile"></i>

            <img onclick="window.location.href='index.html'" src="./assets/img/logo-new.png" alt="logo" class="logo" style="cursor: pointer" />
            <div class="nav__menu">
                <a id="navHome" href="./index.html">TRANG CHỦ</a>
                <a id="navIntroduction" href="./profile.html">THÔNG TIN</a>
                <a id="navShowtimes" href="./showtimes.html">TRUYỆN TRANH</a>
                <a id="navNews" href="./news.html">SẮP XUẤT BẢN</a>
                <a id="navPrice" href="./price.html">ƯU ĐÃI</a>
                <a id="navPrice" href="./sitemap.html">SITEMAP</a>

                <div class="nav__right">
                    <div id="navRightUserInfor" style="display: flex; align-items: center; cursor: pointer"></div>
                    <a href="login.html" id="loginNav">ĐĂNG NHẬP</a>
                    <div class="gio-hang">
                      <a href=""><i class="fas fa-shopping-cart"></i> GIỎ HÀNG</a>
                    </div>
                </div>
            </div>
            <div id="navMobie" class="nav__mobie">
                <div style="display: flex; flex-direction: column; align-items: center" onclick="window.location.replace('./profile.html')">
                    <a id="navMobieUserName" style=" margin-top: 15px; font-size: 18px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Thành viên__</a>
                </div>
                <a href="./index.html">TRANG CHỦ</a>
                <a href="./profile.html">THÔNG TIN</a>
                <a href="./showtimes.html">TRUYỆN TRANH</a>
                <a href="./news.html">SẮP XUẤT BẢN</a>
                <a href="./price.html">ƯU ĐÃI</a>
                <a href="./sitemap.html">SITEMAP</a>
                <a href="login.html" id="navMobieAuth">ĐĂNG NHẬP</a>
            </div>
            <div id="hamburger" class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>

<!-- cart -->
<section class="cart">
    <div class="container">
        <div class="cart-top-wrap">
          <div class="cart-top">
            <div class="cart-top-cart cart-top-item">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="cart-top-adress cart-top-item">
                <i class="fas fa-map-marker-alt"></i>
            </div>
        </div>
        </div>
    </div>
    <div class="container">
        <div class="cart-content row">
            <div class="cart-content-left">
                <table>
                  <thead>
                    <tr>
                      <th>Sản phẩm</th>
                      <th>Tên</th>
                      <th>Giá</th>
                      <th>Số lượng</th>
                      <th>Thàng tiền</th>
                      <th>Xóa</th>
                  </tr>
                  </thead>
                  <tbody>
                    
                  </tbody>  
                  
                </table>
            </div>
            <div class="cart-content-right">
              <table>
                <tr>
                  <th colspan="2">TỔNG TIỀN GIỎ HÀNG</th>
                </tr>
                <tr>
                  <td>TỔNG SẢN PHẨM</td>
                  <td><p id="totalProducts"></p></td>
                </tr>
                <tr>
                  <td>TỔNG TIỀN HÀNG</td>
                  <td><p id="totalAmount"><sup>đ</sup></p></td>
                </tr>
              </table>
              <div class="cart-content-right-button">
                <button onclick="redirectToAddressPage()">THANH TOÁN</button>
              </div>
            </div>
        </div>
    </div>
</section>

<!-- footer -->
<footer class="footer" id="footer">
    <div class="footer__navList">
      <span onclick="window.location.replace('./index.html')"
        >TRANG CHỦ</span
      >
      <span onclick="window.location.replace('./showtimes.html')"
        >TRUYỆN TRANH</span
      >
      <span onclick="window.location.replace('./news.html')"
        >SẮP XUẤT BẢN</span
      >
      <span onclick="window.location.replace('./price.html')">ƯU ĐÃI</span>
    </div>
    <div class="footer__download">
      <img src="./assets/img/downloadAppStore.png" alt="img" />
      <img src="./assets/img/downloadGooglePlay.png" alt="img" />
      <img
        src="./assets/img/logo_da_thong_bao.png"
        width="180px"
        alt="img"
      />
    </div>
    <p class="footer__text">
      Mua sách online tại Bookbuy, bạn được tận hưởng chính sách hỗ trợ miễn phí đổi trả hàng, giao hàng nhanh – tận nơi – miễn phí*, thanh toán linh hoạt - an toàn, đặc biệt giảm thêm trên giá bán khi sử dụng BBxu giúp bạn mua sách online giá 0đ!<br />
      Chỉ với 3 cú click chuột, chưa bao giờ trải nghiệm mua sách online lại dễ chịu và nhẹ nhàng như vậy. Còn chần chờ gì nữa, đặt mua ngay những tựa sách hay cùng hàng ngàn sản phẩm chất lượng khác tại Bookbuy.vn<br />
    </p>
    <div class="footer__logo">
      <img src="./assets/img/logo-new.png" width="100px" alt="logo" />
      <img
        src="./assets/img/Facebook.png"
        onclick="window.open()"
        alt="logo"
      />
      <img src="./assets/img/Gmail.png" alt="logo" />
    </div>
  </footer>
<script>
  // Lấy danh sách sản phẩm từ Local Storage
let cart = localStorage.getItem('cart');
cart = cart ? JSON.parse(cart) : [];

// Hiển thị danh sách sản phẩm trong giỏ hàng
const tbody = document.querySelector('tbody');
cart.forEach(function (product,index) {
    var productPriceStr = parseFloat(product.price.replace("đ", "").replace(".", ""));
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <tr>
            <td><img src="${product.img}" alt=""></td>
            <td><p>${product.name}</p></td>
            <td><p>${product.price}</p></td>
            <td><input type="number" value="${product.quantity}" min="1"></td>
            <td><p class="total-price">${productPriceStr * product.quantity}</p></td>
            <td><span class="delete-product" data-index="${index}">X</span></td>
            <td></td>
        </tr>
    `;
    tbody.appendChild(newRow);
});
// Tính lại cột thành tiền khi số lượng hoặc giá thay đổi
const quantityInputs = document.querySelectorAll('input[type="number"]');
    quantityInputs.forEach(function (input, index) {
        input.addEventListener('input', function () {
            const newQuantity = parseInt(input.value);
            var productPriceStr = parseFloat(cart[index].price.replace("đ", "").replace(".", ""));
            const totalPriceCell = document.querySelectorAll('.total-price')[index];
            totalPriceCell.textContent = productPriceStr * newQuantity;

            cart[index].quantity = newQuantity;
            localStorage.setItem('cart', JSON.stringify(cart));
        });
    });
// Thêm sự kiện click cho các nút "Xóa"
const deleteButtons = document.querySelectorAll('.delete-product');
    deleteButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
            const index = event.target.getAttribute('data-index');

            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));

            location.reload();
        });
    });

// Lấy tất cả các hàng (rows) trong bảng sản phẩm
var rows = document.querySelectorAll(".cart-content-left table tbody tr");

function updateTotals() {
    var totalQuantity = 0;
    var totalPrice = 0;

    for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        
        var quantityCell = row.querySelector("td:nth-child(4) input");
        var quantity = parseInt(quantityCell.value, 10);
        
        var priceCell = row.querySelector("td:nth-child(3) p");
        var priceStr = priceCell.textContent;
        var price = parseFloat(priceStr.replace("đ", "").replace(".", ""));
        
        totalQuantity += quantity;
        totalPrice += price * quantity;
    }

    var totalQuantityElement = document.querySelector(".cart-content-right table tr:nth-child(2) td p");
    totalQuantityElement.textContent = totalQuantity;

    var totalPriceElement = document.querySelector(".cart-content-right table tr:nth-child(3) td p");
    totalPriceElement.textContent = totalPrice.toLocaleString("vi-VN") + " ₫";
}


for (var i = 0; i < rows.length; i++) {
    var row = rows[i];
    var quantityCell = row.querySelector("td:nth-child(4) input");
    quantityCell.addEventListener("change", updateTotals);
}


updateTotals();

</script>
<script>
  // Lấy dữ liệu từ trang và lưu vào Local Storage
function redirectToAddressPage() {
  const totalProducts = document.querySelector("#totalProducts").innerText;
  const totalAmount = document.querySelector("#totalAmount").innerText;
  // Lưu dữ liệu vào Local Storage
  localStorage.setItem("totalProducts", totalProducts);
  localStorage.setItem("totalAmount", totalAmount);


  window.location.href = 'address.html';
}
</script>

<script src="./js/nav.js"></script>
<script src="./js/autoSlide.js"></script>
<script src="./js/cart.js"></script>
<script src="./js/profile.js"></script>
</body>
</html>